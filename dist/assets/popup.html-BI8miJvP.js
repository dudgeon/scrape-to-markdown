import"./modulepreload-polyfill-B5Qt9EMX.js";import{p as ut}from"./url-parser-DW0nA-39.js";import{i as ft,E as gt,g as dt,e as mt,s as Oe}from"./frontmatter-BOATe5ZA.js";import"./constants-I65fpLFJ.js";var Ye={exports:{}};(function(t){function a(e,r){if(r&&r.documentElement)e=r,r=arguments[2];else if(!e||!e.documentElement)throw new Error("First argument to Readability constructor should be a document object.");if(r=r||{},this._doc=e,this._docJSDOMParser=this._doc.firstChild.__JSDOMParser__,this._articleTitle=null,this._articleByline=null,this._articleDir=null,this._articleSiteName=null,this._attempts=[],this._metadata={},this._debug=!!r.debug,this._maxElemsToParse=r.maxElemsToParse||this.DEFAULT_MAX_ELEMS_TO_PARSE,this._nbTopCandidates=r.nbTopCandidates||this.DEFAULT_N_TOP_CANDIDATES,this._charThreshold=r.charThreshold||this.DEFAULT_CHAR_THRESHOLD,this._classesToPreserve=this.CLASSES_TO_PRESERVE.concat(r.classesToPreserve||[]),this._keepClasses=!!r.keepClasses,this._serializer=r.serializer||function(i){return i.innerHTML},this._disableJSONLD=!!r.disableJSONLD,this._allowedVideoRegex=r.allowedVideoRegex||this.REGEXPS.videos,this._linkDensityModifier=r.linkDensityModifier||0,this._flags=this.FLAG_STRIP_UNLIKELYS|this.FLAG_WEIGHT_CLASSES|this.FLAG_CLEAN_CONDITIONALLY,this._debug){let i=function(n){if(n.nodeType==n.TEXT_NODE)return`${n.nodeName} ("${n.textContent}")`;let o=Array.from(n.attributes||[],function(s){return`${s.name}="${s.value}"`}).join(" ");return`<${n.localName} ${o}>`};this.log=function(){if(typeof console<"u"){let o=Array.from(arguments,s=>s&&s.nodeType==this.ELEMENT_NODE?i(s):s);o.unshift("Reader: (Readability)"),console.log(...o)}else if(typeof dump<"u"){var n=Array.prototype.map.call(arguments,function(o){return o&&o.nodeName?i(o):o}).join(" ");dump("Reader: (Readability) "+n+`
`)}}}else this.log=function(){}}a.prototype={FLAG_STRIP_UNLIKELYS:1,FLAG_WEIGHT_CLASSES:2,FLAG_CLEAN_CONDITIONALLY:4,ELEMENT_NODE:1,TEXT_NODE:3,DEFAULT_MAX_ELEMS_TO_PARSE:0,DEFAULT_N_TOP_CANDIDATES:5,DEFAULT_TAGS_TO_SCORE:"section,h2,h3,h4,h5,h6,p,td,pre".toUpperCase().split(","),DEFAULT_CHAR_THRESHOLD:500,REGEXPS:{unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i,positive:/article|body|content|entry|hentry|h-entry|main|page|pagination|post|text|blog|story/i,negative:/-ad-|hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|footer|gdpr|masthead|media|meta|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|widget/i,extraneous:/print|archive|comment|discuss|e[\-]?mail|share|reply|all|login|sign|single|utility/i,byline:/byline|author|dateline|writtenby|p-author/i,replaceFonts:/<(\/?)font[^>]*>/gi,normalize:/\s{2,}/g,videos:/\/\/(www\.)?((dailymotion|youtube|youtube-nocookie|player\.vimeo|v\.qq)\.com|(archive|upload\.wikimedia)\.org|player\.twitch\.tv)/i,shareElements:/(\b|_)(share|sharedaddy)(\b|_)/i,nextLink:/(next|weiter|continue|>([^\|]|$)|»([^\|]|$))/i,prevLink:/(prev|earl|old|new|<|«)/i,tokenize:/\W+/g,whitespace:/^\s*$/,hasContent:/\S$/,hashUrl:/^#.+/,srcsetUrl:/(\S+)(\s+[\d.]+[xw])?(\s*(?:,|$))/g,b64DataUrl:/^data:\s*([^\s;,]+)\s*;\s*base64\s*,/i,commas:/\u002C|\u060C|\uFE50|\uFE10|\uFE11|\u2E41|\u2E34|\u2E32|\uFF0C/g,jsonLdArticleTypes:/^Article|AdvertiserContentArticle|NewsArticle|AnalysisNewsArticle|AskPublicNewsArticle|BackgroundNewsArticle|OpinionNewsArticle|ReportageNewsArticle|ReviewNewsArticle|Report|SatiricalArticle|ScholarlyArticle|MedicalScholarlyArticle|SocialMediaPosting|BlogPosting|LiveBlogPosting|DiscussionForumPosting|TechArticle|APIReference$/,adWords:/^(ad(vertising|vertisement)?|pub(licité)?|werb(ung)?|广告|Реклама|Anuncio)$/iu,loadingWords:/^((loading|正在加载|Загрузка|chargement|cargando)(…|\.\.\.)?)$/iu},UNLIKELY_ROLES:["menu","menubar","complementary","navigation","alert","alertdialog","dialog"],DIV_TO_P_ELEMS:new Set(["BLOCKQUOTE","DL","DIV","IMG","OL","P","PRE","TABLE","UL"]),ALTER_TO_DIV_EXCEPTIONS:["DIV","ARTICLE","SECTION","P","OL","UL"],PRESENTATIONAL_ATTRIBUTES:["align","background","bgcolor","border","cellpadding","cellspacing","frame","hspace","rules","style","valign","vspace"],DEPRECATED_SIZE_ATTRIBUTE_ELEMS:["TABLE","TH","TD","HR","PRE"],PHRASING_ELEMS:["ABBR","AUDIO","B","BDO","BR","BUTTON","CITE","CODE","DATA","DATALIST","DFN","EM","EMBED","I","IMG","INPUT","KBD","LABEL","MARK","MATH","METER","NOSCRIPT","OBJECT","OUTPUT","PROGRESS","Q","RUBY","SAMP","SCRIPT","SELECT","SMALL","SPAN","STRONG","SUB","SUP","TEXTAREA","TIME","VAR","WBR"],CLASSES_TO_PRESERVE:["page"],HTML_ESCAPE_MAP:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"},_postProcessContent(e){this._fixRelativeUris(e),this._simplifyNestedElements(e),this._keepClasses||this._cleanClasses(e)},_removeNodes(e,r){if(this._docJSDOMParser&&e._isLiveNodeList)throw new Error("Do not pass live node lists to _removeNodes");for(var i=e.length-1;i>=0;i--){var n=e[i],o=n.parentNode;o&&(!r||r.call(this,n,i,e))&&o.removeChild(n)}},_replaceNodeTags(e,r){if(this._docJSDOMParser&&e._isLiveNodeList)throw new Error("Do not pass live node lists to _replaceNodeTags");for(const i of e)this._setNodeTag(i,r)},_forEachNode(e,r){Array.prototype.forEach.call(e,r,this)},_findNode(e,r){return Array.prototype.find.call(e,r,this)},_someNode(e,r){return Array.prototype.some.call(e,r,this)},_everyNode(e,r){return Array.prototype.every.call(e,r,this)},_getAllNodesWithTag(e,r){return e.querySelectorAll?e.querySelectorAll(r.join(",")):[].concat.apply([],r.map(function(i){var n=e.getElementsByTagName(i);return Array.isArray(n)?n:Array.from(n)}))},_cleanClasses(e){var r=this._classesToPreserve,i=(e.getAttribute("class")||"").split(/\s+/).filter(n=>r.includes(n)).join(" ");for(i?e.setAttribute("class",i):e.removeAttribute("class"),e=e.firstElementChild;e;e=e.nextElementSibling)this._cleanClasses(e)},_isUrl(e){try{return new URL(e),!0}catch{return!1}},_fixRelativeUris(e){var r=this._doc.baseURI,i=this._doc.documentURI;function n(l){if(r==i&&l.charAt(0)=="#")return l;try{return new URL(l,r).href}catch{}return l}var o=this._getAllNodesWithTag(e,["a"]);this._forEachNode(o,function(l){var h=l.getAttribute("href");if(h)if(h.indexOf("javascript:")===0)if(l.childNodes.length===1&&l.childNodes[0].nodeType===this.TEXT_NODE){var f=this._doc.createTextNode(l.textContent);l.parentNode.replaceChild(f,l)}else{for(var c=this._doc.createElement("span");l.firstChild;)c.appendChild(l.firstChild);l.parentNode.replaceChild(c,l)}else l.setAttribute("href",n(h))});var s=this._getAllNodesWithTag(e,["img","picture","figure","video","audio","source"]);this._forEachNode(s,function(l){var h=l.getAttribute("src"),f=l.getAttribute("poster"),c=l.getAttribute("srcset");if(h&&l.setAttribute("src",n(h)),f&&l.setAttribute("poster",n(f)),c){var u=c.replace(this.REGEXPS.srcsetUrl,function(m,v,N,L){return n(v)+(N||"")+L});l.setAttribute("srcset",u)}})},_simplifyNestedElements(e){for(var r=e;r;){if(r.parentNode&&["DIV","SECTION"].includes(r.tagName)&&!(r.id&&r.id.startsWith("readability"))){if(this._isElementWithoutContent(r)){r=this._removeAndGetNext(r);continue}else if(this._hasSingleTagInsideElement(r,"DIV")||this._hasSingleTagInsideElement(r,"SECTION")){for(var i=r.children[0],n=0;n<r.attributes.length;n++)i.setAttributeNode(r.attributes[n].cloneNode());r.parentNode.replaceChild(i,r),r=i;continue}}r=this._getNextNode(r)}},_getArticleTitle(){var e=this._doc,r="",i="";try{r=i=e.title.trim(),typeof r!="string"&&(r=i=this._getInnerText(e.getElementsByTagName("title")[0]))}catch{}var n=!1;function o(u){return u.split(/\s+/).length}if(/ [\|\-\\\/>»] /.test(r)){n=/ [\\\/>»] /.test(r);let u=Array.from(i.matchAll(/ [\|\-\\\/>»] /gi));r=i.substring(0,u.pop().index),o(r)<3&&(r=i.replace(/^[^\|\-\\\/>»]*[\|\-\\\/>»]/gi,""))}else if(r.includes(": ")){var s=this._getAllNodesWithTag(e,["h1","h2"]),l=r.trim(),h=this._someNode(s,function(u){return u.textContent.trim()===l});h||(r=i.substring(i.lastIndexOf(":")+1),o(r)<3?r=i.substring(i.indexOf(":")+1):o(i.substr(0,i.indexOf(":")))>5&&(r=i))}else if(r.length>150||r.length<15){var f=e.getElementsByTagName("h1");f.length===1&&(r=this._getInnerText(f[0]))}r=r.trim().replace(this.REGEXPS.normalize," ");var c=o(r);return c<=4&&(!n||c!=o(i.replace(/[\|\-\\\/>»]+/g,""))-1)&&(r=i),r},_prepDocument(){var e=this._doc;this._removeNodes(this._getAllNodesWithTag(e,["style"])),e.body&&this._replaceBrs(e.body),this._replaceNodeTags(this._getAllNodesWithTag(e,["font"]),"SPAN")},_nextNode(e){for(var r=e;r&&r.nodeType!=this.ELEMENT_NODE&&this.REGEXPS.whitespace.test(r.textContent);)r=r.nextSibling;return r},_replaceBrs(e){this._forEachNode(this._getAllNodesWithTag(e,["br"]),function(r){for(var i=r.nextSibling,n=!1;(i=this._nextNode(i))&&i.tagName=="BR";){n=!0;var o=i.nextSibling;i.remove(),i=o}if(n){var s=this._doc.createElement("p");for(r.parentNode.replaceChild(s,r),i=s.nextSibling;i;){if(i.tagName=="BR"){var l=this._nextNode(i.nextSibling);if(l&&l.tagName=="BR")break}if(!this._isPhrasingContent(i))break;var h=i.nextSibling;s.appendChild(i),i=h}for(;s.lastChild&&this._isWhitespace(s.lastChild);)s.lastChild.remove();s.parentNode.tagName==="P"&&this._setNodeTag(s.parentNode,"DIV")}})},_setNodeTag(e,r){if(this.log("_setNodeTag",e,r),this._docJSDOMParser)return e.localName=r.toLowerCase(),e.tagName=r.toUpperCase(),e;for(var i=e.ownerDocument.createElement(r);e.firstChild;)i.appendChild(e.firstChild);e.parentNode.replaceChild(i,e),e.readability&&(i.readability=e.readability);for(var n=0;n<e.attributes.length;n++)i.setAttributeNode(e.attributes[n].cloneNode());return i},_prepArticle(e){this._cleanStyles(e),this._markDataTables(e),this._fixLazyImages(e),this._cleanConditionally(e,"form"),this._cleanConditionally(e,"fieldset"),this._clean(e,"object"),this._clean(e,"embed"),this._clean(e,"footer"),this._clean(e,"link"),this._clean(e,"aside");var r=this.DEFAULT_CHAR_THRESHOLD;this._forEachNode(e.children,function(i){this._cleanMatchedNodes(i,function(n,o){return this.REGEXPS.shareElements.test(o)&&n.textContent.length<r})}),this._clean(e,"iframe"),this._clean(e,"input"),this._clean(e,"textarea"),this._clean(e,"select"),this._clean(e,"button"),this._cleanHeaders(e),this._cleanConditionally(e,"table"),this._cleanConditionally(e,"ul"),this._cleanConditionally(e,"div"),this._replaceNodeTags(this._getAllNodesWithTag(e,["h1"]),"h2"),this._removeNodes(this._getAllNodesWithTag(e,["p"]),function(i){var n=this._getAllNodesWithTag(i,["img","embed","object","iframe"]).length;return n===0&&!this._getInnerText(i,!1)}),this._forEachNode(this._getAllNodesWithTag(e,["br"]),function(i){var n=this._nextNode(i.nextSibling);n&&n.tagName=="P"&&i.remove()}),this._forEachNode(this._getAllNodesWithTag(e,["table"]),function(i){var n=this._hasSingleTagInsideElement(i,"TBODY")?i.firstElementChild:i;if(this._hasSingleTagInsideElement(n,"TR")){var o=n.firstElementChild;if(this._hasSingleTagInsideElement(o,"TD")){var s=o.firstElementChild;s=this._setNodeTag(s,this._everyNode(s.childNodes,this._isPhrasingContent)?"P":"DIV"),i.parentNode.replaceChild(s,i)}}})},_initializeNode(e){switch(e.readability={contentScore:0},e.tagName){case"DIV":e.readability.contentScore+=5;break;case"PRE":case"TD":case"BLOCKQUOTE":e.readability.contentScore+=3;break;case"ADDRESS":case"OL":case"UL":case"DL":case"DD":case"DT":case"LI":case"FORM":e.readability.contentScore-=3;break;case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"TH":e.readability.contentScore-=5;break}e.readability.contentScore+=this._getClassWeight(e)},_removeAndGetNext(e){var r=this._getNextNode(e,!0);return e.remove(),r},_getNextNode(e,r){if(!r&&e.firstElementChild)return e.firstElementChild;if(e.nextElementSibling)return e.nextElementSibling;do e=e.parentNode;while(e&&!e.nextElementSibling);return e&&e.nextElementSibling},_textSimilarity(e,r){var i=e.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean),n=r.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean);if(!i.length||!n.length)return 0;var o=n.filter(l=>!i.includes(l)),s=o.join(" ").length/n.join(" ").length;return 1-s},_isValidByline(e,r){var i=e.getAttribute("rel"),n=e.getAttribute("itemprop"),o=e.textContent.trim().length;return(i==="author"||n&&n.includes("author")||this.REGEXPS.byline.test(r))&&!!o&&o<100},_getNodeAncestors(e,r){r=r||0;for(var i=0,n=[];e.parentNode&&(n.push(e.parentNode),!(r&&++i===r));)e=e.parentNode;return n},_grabArticle(e){this.log("**** grabArticle ****");var r=this._doc,i=e!==null;if(e=e||this._doc.body,!e)return this.log("No body found in document. Abort."),null;for(var n=e.innerHTML;;){this.log("Starting grabArticle loop");var o=this._flagIsActive(this.FLAG_STRIP_UNLIKELYS),s=[],l=this._doc.documentElement;let Be=!0;for(;l;){l.tagName==="HTML"&&(this._articleLang=l.getAttribute("lang"));var h=l.className+" "+l.id;if(!this._isProbablyVisible(l)){this.log("Removing hidden node - "+h),l=this._removeAndGetNext(l);continue}if(l.getAttribute("aria-modal")=="true"&&l.getAttribute("role")=="dialog"){l=this._removeAndGetNext(l);continue}if(!this._articleByline&&!this._metadata.byline&&this._isValidByline(l,h)){for(var f=this._getNextNode(l,!0),c=this._getNextNode(l),u=null;c&&c!=f;){var m=c.getAttribute("itemprop");if(m&&m.includes("name")){u=c;break}else c=this._getNextNode(c)}this._articleByline=(u??l).textContent.trim(),l=this._removeAndGetNext(l);continue}if(Be&&this._headerDuplicatesTitle(l)){this.log("Removing header: ",l.textContent.trim(),this._articleTitle.trim()),Be=!1,l=this._removeAndGetNext(l);continue}if(o){if(this.REGEXPS.unlikelyCandidates.test(h)&&!this.REGEXPS.okMaybeItsACandidate.test(h)&&!this._hasAncestorTag(l,"table")&&!this._hasAncestorTag(l,"code")&&l.tagName!=="BODY"&&l.tagName!=="A"){this.log("Removing unlikely candidate - "+h),l=this._removeAndGetNext(l);continue}if(this.UNLIKELY_ROLES.includes(l.getAttribute("role"))){this.log("Removing content with role "+l.getAttribute("role")+" - "+h),l=this._removeAndGetNext(l);continue}}if((l.tagName==="DIV"||l.tagName==="SECTION"||l.tagName==="HEADER"||l.tagName==="H1"||l.tagName==="H2"||l.tagName==="H3"||l.tagName==="H4"||l.tagName==="H5"||l.tagName==="H6")&&this._isElementWithoutContent(l)){l=this._removeAndGetNext(l);continue}if(this.DEFAULT_TAGS_TO_SCORE.includes(l.tagName)&&s.push(l),l.tagName==="DIV"){for(var v=null,N=l.firstChild;N;){var L=N.nextSibling;if(this._isPhrasingContent(N))v!==null?v.appendChild(N):this._isWhitespace(N)||(v=r.createElement("p"),l.replaceChild(v,N),v.appendChild(N));else if(v!==null){for(;v.lastChild&&this._isWhitespace(v.lastChild);)v.lastChild.remove();v=null}N=L}if(this._hasSingleTagInsideElement(l,"P")&&this._getLinkDensity(l)<.25){var w=l.children[0];l.parentNode.replaceChild(w,l),l=w,s.push(l)}else this._hasChildBlockElement(l)||(l=this._setNodeTag(l,"P"),s.push(l))}l=this._getNextNode(l)}var A=[];this._forEachNode(s,function(S){if(!(!S.parentNode||typeof S.parentNode.tagName>"u")){var x=this._getInnerText(S);if(!(x.length<25)){var Pe=this._getNodeAncestors(S,5);if(Pe.length!==0){var W=0;W+=1,W+=x.split(this.REGEXPS.commas).length,W+=Math.min(Math.floor(x.length/100),3),this._forEachNode(Pe,function(C,re){if(!(!C.tagName||!C.parentNode||typeof C.parentNode.tagName>"u")){if(typeof C.readability>"u"&&(this._initializeNode(C),A.push(C)),re===0)var ie=1;else re===1?ie=2:ie=re*3;C.readability.contentScore+=W/ie}})}}}});for(var b=[],R=0,B=A.length;R<B;R+=1){var T=A[R],P=T.readability.contentScore*(1-this._getLinkDensity(T));T.readability.contentScore=P,this.log("Candidate:",T,"with score "+P);for(var I=0;I<this._nbTopCandidates;I++){var O=b[I];if(!O||P>O.readability.contentScore){b.splice(I,0,T),b.length>this._nbTopCandidates&&b.pop();break}}}var g=b[0]||null,D=!1,d;if(g===null||g.tagName==="BODY"){for(g=r.createElement("DIV"),D=!0;e.firstChild;)this.log("Moving child out:",e.firstChild),g.appendChild(e.firstChild);e.appendChild(g),this._initializeNode(g)}else if(g){for(var _=[],M=1;M<b.length;M++)b[M].readability.contentScore/g.readability.contentScore>=.75&&_.push(this._getNodeAncestors(b[M]));var K=3;if(_.length>=K)for(d=g.parentNode;d.tagName!=="BODY";){for(var z=0,J=0;J<_.length&&z<K;J++)z+=Number(_[J].includes(d));if(z>=K){g=d;break}d=d.parentNode}g.readability||this._initializeNode(g),d=g.parentNode;for(var Q=g.readability.contentScore,ot=Q/3;d.tagName!=="BODY";){if(!d.readability){d=d.parentNode;continue}var xe=d.readability.contentScore;if(xe<ot)break;if(xe>Q){g=d;break}Q=d.readability.contentScore,d=d.parentNode}for(d=g.parentNode;d.tagName!="BODY"&&d.children.length==1;)g=d,d=g.parentNode;g.readability||this._initializeNode(g)}var y=r.createElement("DIV");i&&(y.id="readability-content");var ct=Math.max(10,g.readability.contentScore*.2);d=g.parentNode;for(var Z=d.children,G=0,Re=Z.length;G<Re;G++){var p=Z[G],H=!1;if(this.log("Looking at sibling node:",p,p.readability?"with score "+p.readability.contentScore:""),this.log("Sibling has score",p.readability?p.readability.contentScore:"Unknown"),p===g)H=!0;else{var Ie=0;if(p.className===g.className&&g.className!==""&&(Ie+=g.readability.contentScore*.2),p.readability&&p.readability.contentScore+Ie>=ct)H=!0;else if(p.nodeName==="P"){var Ce=this._getLinkDensity(p),De=this._getInnerText(p),ee=De.length;(ee>80&&Ce<.25||ee<80&&ee>0&&Ce===0&&De.search(/\.( |$)/)!==-1)&&(H=!0)}}H&&(this.log("Appending node:",p),this.ALTER_TO_DIV_EXCEPTIONS.includes(p.nodeName)||(this.log("Altering sibling:",p,"to div."),p=this._setNodeTag(p,"DIV")),y.appendChild(p),Z=d.children,G-=1,Re-=1)}if(this._debug&&this.log("Article content pre-prep: "+y.innerHTML),this._prepArticle(y),this._debug&&this.log("Article content post-prep: "+y.innerHTML),D)g.id="readability-page-1",g.className="page";else{var F=r.createElement("DIV");for(F.id="readability-page-1",F.className="page";y.firstChild;)F.appendChild(y.firstChild);y.appendChild(F)}this._debug&&this.log("Article content after paging: "+y.innerHTML);var te=!0,ke=this._getInnerText(y,!0).length;if(ke<this._charThreshold)if(te=!1,e.innerHTML=n,this._attempts.push({articleContent:y,textLength:ke}),this._flagIsActive(this.FLAG_STRIP_UNLIKELYS))this._removeFlag(this.FLAG_STRIP_UNLIKELYS);else if(this._flagIsActive(this.FLAG_WEIGHT_CLASSES))this._removeFlag(this.FLAG_WEIGHT_CLASSES);else if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY))this._removeFlag(this.FLAG_CLEAN_CONDITIONALLY);else{if(this._attempts.sort(function(S,x){return x.textLength-S.textLength}),!this._attempts[0].textLength)return null;y=this._attempts[0].articleContent,te=!0}if(te){var ht=[d,g].concat(this._getNodeAncestors(d));return this._someNode(ht,function(S){if(!S.tagName)return!1;var x=S.getAttribute("dir");return x?(this._articleDir=x,!0):!1}),y}}},_unescapeHtmlEntities(e){if(!e)return e;var r=this.HTML_ESCAPE_MAP;return e.replace(/&(quot|amp|apos|lt|gt);/g,function(i,n){return r[n]}).replace(/&#(?:x([0-9a-f]+)|([0-9]+));/gi,function(i,n,o){var s=parseInt(n||o,n?16:10);return(s==0||s>1114111||s>=55296&&s<=57343)&&(s=65533),String.fromCodePoint(s)})},_getJSONLD(e){var r=this._getAllNodesWithTag(e,["script"]),i;return this._forEachNode(r,function(n){if(!i&&n.getAttribute("type")==="application/ld+json")try{var o=n.textContent.replace(/^\s*<!\[CDATA\[|\]\]>\s*$/g,""),s=JSON.parse(o);if(Array.isArray(s)&&(s=s.find(m=>m["@type"]&&m["@type"].match(this.REGEXPS.jsonLdArticleTypes)),!s))return;var l=/^https?\:\/\/schema\.org\/?$/,h=typeof s["@context"]=="string"&&s["@context"].match(l)||typeof s["@context"]=="object"&&typeof s["@context"]["@vocab"]=="string"&&s["@context"]["@vocab"].match(l);if(!h||(!s["@type"]&&Array.isArray(s["@graph"])&&(s=s["@graph"].find(m=>(m["@type"]||"").match(this.REGEXPS.jsonLdArticleTypes))),!s||!s["@type"]||!s["@type"].match(this.REGEXPS.jsonLdArticleTypes)))return;if(i={},typeof s.name=="string"&&typeof s.headline=="string"&&s.name!==s.headline){var f=this._getArticleTitle(),c=this._textSimilarity(s.name,f)>.75,u=this._textSimilarity(s.headline,f)>.75;u&&!c?i.title=s.headline:i.title=s.name}else typeof s.name=="string"?i.title=s.name.trim():typeof s.headline=="string"&&(i.title=s.headline.trim());s.author&&(typeof s.author.name=="string"?i.byline=s.author.name.trim():Array.isArray(s.author)&&s.author[0]&&typeof s.author[0].name=="string"&&(i.byline=s.author.filter(function(m){return m&&typeof m.name=="string"}).map(function(m){return m.name.trim()}).join(", "))),typeof s.description=="string"&&(i.excerpt=s.description.trim()),s.publisher&&typeof s.publisher.name=="string"&&(i.siteName=s.publisher.name.trim()),typeof s.datePublished=="string"&&(i.datePublished=s.datePublished.trim())}catch(m){this.log(m.message)}}),i||{}},_getArticleMetadata(e){var r={},i={},n=this._doc.getElementsByTagName("meta"),o=/\s*(article|dc|dcterm|og|twitter)\s*:\s*(author|creator|description|published_time|title|site_name)\s*/gi,s=/^\s*(?:(dc|dcterm|og|twitter|parsely|weibo:(article|webpage))\s*[-\.:]\s*)?(author|creator|pub-date|description|title|site_name)\s*$/i;this._forEachNode(n,function(h){var f=h.getAttribute("name"),c=h.getAttribute("property"),u=h.getAttribute("content");if(u){var m=null,v=null;c&&(m=c.match(o),m&&(v=m[0].toLowerCase().replace(/\s/g,""),i[v]=u.trim())),!m&&f&&s.test(f)&&(v=f,u&&(v=v.toLowerCase().replace(/\s/g,"").replace(/\./g,":"),i[v]=u.trim()))}}),r.title=e.title||i["dc:title"]||i["dcterm:title"]||i["og:title"]||i["weibo:article:title"]||i["weibo:webpage:title"]||i.title||i["twitter:title"]||i["parsely-title"],r.title||(r.title=this._getArticleTitle());const l=typeof i["article:author"]=="string"&&!this._isUrl(i["article:author"])?i["article:author"]:void 0;return r.byline=e.byline||i["dc:creator"]||i["dcterm:creator"]||i.author||i["parsely-author"]||l,r.excerpt=e.excerpt||i["dc:description"]||i["dcterm:description"]||i["og:description"]||i["weibo:article:description"]||i["weibo:webpage:description"]||i.description||i["twitter:description"],r.siteName=e.siteName||i["og:site_name"],r.publishedTime=e.datePublished||i["article:published_time"]||i["parsely-pub-date"]||null,r.title=this._unescapeHtmlEntities(r.title),r.byline=this._unescapeHtmlEntities(r.byline),r.excerpt=this._unescapeHtmlEntities(r.excerpt),r.siteName=this._unescapeHtmlEntities(r.siteName),r.publishedTime=this._unescapeHtmlEntities(r.publishedTime),r},_isSingleImage(e){for(;e;){if(e.tagName==="IMG")return!0;if(e.children.length!==1||e.textContent.trim()!=="")return!1;e=e.children[0]}return!1},_unwrapNoscriptImages(e){var r=Array.from(e.getElementsByTagName("img"));this._forEachNode(r,function(n){for(var o=0;o<n.attributes.length;o++){var s=n.attributes[o];switch(s.name){case"src":case"srcset":case"data-src":case"data-srcset":return}if(/\.(jpg|jpeg|png|webp)/i.test(s.value))return}n.remove()});var i=Array.from(e.getElementsByTagName("noscript"));this._forEachNode(i,function(n){if(this._isSingleImage(n)){var o=e.createElement("div");o.innerHTML=n.innerHTML;var s=n.previousElementSibling;if(s&&this._isSingleImage(s)){var l=s;l.tagName!=="IMG"&&(l=s.getElementsByTagName("img")[0]);for(var h=o.getElementsByTagName("img")[0],f=0;f<l.attributes.length;f++){var c=l.attributes[f];if(c.value!==""&&(c.name==="src"||c.name==="srcset"||/\.(jpg|jpeg|png|webp)/i.test(c.value))){if(h.getAttribute(c.name)===c.value)continue;var u=c.name;h.hasAttribute(u)&&(u="data-old-"+u),h.setAttribute(u,c.value)}}n.parentNode.replaceChild(o.firstElementChild,s)}}})},_removeScripts(e){this._removeNodes(this._getAllNodesWithTag(e,["script","noscript"]))},_hasSingleTagInsideElement(e,r){return e.children.length!=1||e.children[0].tagName!==r?!1:!this._someNode(e.childNodes,function(i){return i.nodeType===this.TEXT_NODE&&this.REGEXPS.hasContent.test(i.textContent)})},_isElementWithoutContent(e){return e.nodeType===this.ELEMENT_NODE&&!e.textContent.trim().length&&(!e.children.length||e.children.length==e.getElementsByTagName("br").length+e.getElementsByTagName("hr").length)},_hasChildBlockElement(e){return this._someNode(e.childNodes,function(r){return this.DIV_TO_P_ELEMS.has(r.tagName)||this._hasChildBlockElement(r)})},_isPhrasingContent(e){return e.nodeType===this.TEXT_NODE||this.PHRASING_ELEMS.includes(e.tagName)||(e.tagName==="A"||e.tagName==="DEL"||e.tagName==="INS")&&this._everyNode(e.childNodes,this._isPhrasingContent)},_isWhitespace(e){return e.nodeType===this.TEXT_NODE&&e.textContent.trim().length===0||e.nodeType===this.ELEMENT_NODE&&e.tagName==="BR"},_getInnerText(e,r){r=typeof r>"u"?!0:r;var i=e.textContent.trim();return r?i.replace(this.REGEXPS.normalize," "):i},_getCharCount(e,r){return r=r||",",this._getInnerText(e).split(r).length-1},_cleanStyles(e){if(!(!e||e.tagName.toLowerCase()==="svg")){for(var r=0;r<this.PRESENTATIONAL_ATTRIBUTES.length;r++)e.removeAttribute(this.PRESENTATIONAL_ATTRIBUTES[r]);this.DEPRECATED_SIZE_ATTRIBUTE_ELEMS.includes(e.tagName)&&(e.removeAttribute("width"),e.removeAttribute("height"));for(var i=e.firstElementChild;i!==null;)this._cleanStyles(i),i=i.nextElementSibling}},_getLinkDensity(e){var r=this._getInnerText(e).length;if(r===0)return 0;var i=0;return this._forEachNode(e.getElementsByTagName("a"),function(n){var o=n.getAttribute("href"),s=o&&this.REGEXPS.hashUrl.test(o)?.3:1;i+=this._getInnerText(n).length*s}),i/r},_getClassWeight(e){if(!this._flagIsActive(this.FLAG_WEIGHT_CLASSES))return 0;var r=0;return typeof e.className=="string"&&e.className!==""&&(this.REGEXPS.negative.test(e.className)&&(r-=25),this.REGEXPS.positive.test(e.className)&&(r+=25)),typeof e.id=="string"&&e.id!==""&&(this.REGEXPS.negative.test(e.id)&&(r-=25),this.REGEXPS.positive.test(e.id)&&(r+=25)),r},_clean(e,r){var i=["object","embed","iframe"].includes(r);this._removeNodes(this._getAllNodesWithTag(e,[r]),function(n){if(i){for(var o=0;o<n.attributes.length;o++)if(this._allowedVideoRegex.test(n.attributes[o].value))return!1;if(n.tagName==="object"&&this._allowedVideoRegex.test(n.innerHTML))return!1}return!0})},_hasAncestorTag(e,r,i,n){i=i||3,r=r.toUpperCase();for(var o=0;e.parentNode;){if(i>0&&o>i)return!1;if(e.parentNode.tagName===r&&(!n||n(e.parentNode)))return!0;e=e.parentNode,o++}return!1},_getRowAndColumnCount(e){for(var r=0,i=0,n=e.getElementsByTagName("tr"),o=0;o<n.length;o++){var s=n[o].getAttribute("rowspan")||0;s&&(s=parseInt(s,10)),r+=s||1;for(var l=0,h=n[o].getElementsByTagName("td"),f=0;f<h.length;f++){var c=h[f].getAttribute("colspan")||0;c&&(c=parseInt(c,10)),l+=c||1}i=Math.max(i,l)}return{rows:r,columns:i}},_markDataTables(e){for(var r=e.getElementsByTagName("table"),i=0;i<r.length;i++){var n=r[i],o=n.getAttribute("role");if(o=="presentation"){n._readabilityDataTable=!1;continue}var s=n.getAttribute("datatable");if(s=="0"){n._readabilityDataTable=!1;continue}var l=n.getAttribute("summary");if(l){n._readabilityDataTable=!0;continue}var h=n.getElementsByTagName("caption")[0];if(h&&h.childNodes.length){n._readabilityDataTable=!0;continue}var f=["col","colgroup","tfoot","thead","th"],c=function(m){return!!n.getElementsByTagName(m)[0]};if(f.some(c)){this.log("Data table because found data-y descendant"),n._readabilityDataTable=!0;continue}if(n.getElementsByTagName("table")[0]){n._readabilityDataTable=!1;continue}var u=this._getRowAndColumnCount(n);if(u.columns==1||u.rows==1){n._readabilityDataTable=!1;continue}if(u.rows>=10||u.columns>4){n._readabilityDataTable=!0;continue}n._readabilityDataTable=u.rows*u.columns>10}},_fixLazyImages(e){this._forEachNode(this._getAllNodesWithTag(e,["img","picture","figure"]),function(r){if(r.src&&this.REGEXPS.b64DataUrl.test(r.src)){var i=this.REGEXPS.b64DataUrl.exec(r.src);if(i[1]==="image/svg+xml")return;for(var n=!1,o=0;o<r.attributes.length;o++){var s=r.attributes[o];if(s.name!=="src"&&/\.(jpg|jpeg|png|webp)/i.test(s.value)){n=!0;break}}if(n){var l=i[0].length,h=r.src.length-l;h<133&&r.removeAttribute("src")}}if(!((r.src||r.srcset&&r.srcset!="null")&&!r.className.toLowerCase().includes("lazy"))){for(var f=0;f<r.attributes.length;f++)if(s=r.attributes[f],!(s.name==="src"||s.name==="srcset"||s.name==="alt")){var c=null;if(/\.(jpg|jpeg|png|webp)\s+\d/.test(s.value)?c="srcset":/^\s*\S+\.(jpg|jpeg|png|webp)\S*\s*$/.test(s.value)&&(c="src"),c){if(r.tagName==="IMG"||r.tagName==="PICTURE")r.setAttribute(c,s.value);else if(r.tagName==="FIGURE"&&!this._getAllNodesWithTag(r,["img","picture"]).length){var u=this._doc.createElement("img");u.setAttribute(c,s.value),r.appendChild(u)}}}}})},_getTextDensity(e,r){var i=this._getInnerText(e,!0).length;if(i===0)return 0;var n=0,o=this._getAllNodesWithTag(e,r);return this._forEachNode(o,s=>n+=this._getInnerText(s,!0).length),n/i},_cleanConditionally(e,r){this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)&&this._removeNodes(this._getAllNodesWithTag(e,[r]),function(i){var n=function(d){return d._readabilityDataTable},o=r==="ul"||r==="ol";if(!o){var s=0,l=this._getAllNodesWithTag(i,["ul","ol"]);this._forEachNode(l,d=>s+=this._getInnerText(d).length),o=s/this._getInnerText(i).length>.9}if(r==="table"&&n(i)||this._hasAncestorTag(i,"table",-1,n)||this._hasAncestorTag(i,"code")||[...i.getElementsByTagName("table")].some(d=>d._readabilityDataTable))return!1;var h=this._getClassWeight(i);this.log("Cleaning Conditionally",i);var f=0;if(h+f<0)return!0;if(this._getCharCount(i,",")<10){for(var c=i.getElementsByTagName("p").length,u=i.getElementsByTagName("img").length,m=i.getElementsByTagName("li").length-100,v=i.getElementsByTagName("input").length,N=this._getTextDensity(i,["h1","h2","h3","h4","h5","h6"]),L=0,w=this._getAllNodesWithTag(i,["object","embed","iframe"]),A=0;A<w.length;A++){for(var b=0;b<w[A].attributes.length;b++)if(this._allowedVideoRegex.test(w[A].attributes[b].value))return!1;if(w[A].tagName==="object"&&this._allowedVideoRegex.test(w[A].innerHTML))return!1;L++}var R=this._getInnerText(i);if(this.REGEXPS.adWords.test(R)||this.REGEXPS.loadingWords.test(R))return!0;var B=R.length,T=this._getLinkDensity(i),P=["SPAN","LI","TD"].concat(Array.from(this.DIV_TO_P_ELEMS)),I=this._getTextDensity(i,P),O=this._hasAncestorTag(i,"figure"),g=(()=>{const _=[];return!O&&u>1&&c/u<.5&&_.push(`Bad p to img ratio (img=${u}, p=${c})`),!o&&m>c&&_.push(`Too many li's outside of a list. (li=${m} > p=${c})`),v>Math.floor(c/3)&&_.push(`Too many inputs per p. (input=${v}, p=${c})`),!o&&!O&&N<.9&&B<25&&(u===0||u>2)&&T>0&&_.push(`Suspiciously short. (headingDensity=${N}, img=${u}, linkDensity=${T})`),!o&&h<25&&T>.2+this._linkDensityModifier&&_.push(`Low weight and a little linky. (linkDensity=${T})`),h>=25&&T>.5+this._linkDensityModifier&&_.push(`High weight and mostly links. (linkDensity=${T})`),(L===1&&B<75||L>1)&&_.push(`Suspicious embed. (embedCount=${L}, contentLength=${B})`),u===0&&I===0&&_.push(`No useful content. (img=${u}, textDensity=${I})`),_.length?(this.log("Checks failed",_),!0):!1})();if(o&&g){for(var D=0;D<i.children.length;D++)if(i.children[D].children.length>1)return g;let _=i.getElementsByTagName("li").length;if(u==_)return!1}return g}return!1})},_cleanMatchedNodes(e,r){for(var i=this._getNextNode(e,!0),n=this._getNextNode(e);n&&n!=i;)r.call(this,n,n.className+" "+n.id)?n=this._removeAndGetNext(n):n=this._getNextNode(n)},_cleanHeaders(e){let r=this._getAllNodesWithTag(e,["h1","h2"]);this._removeNodes(r,function(i){let n=this._getClassWeight(i)<0;return n&&this.log("Removing header with low class weight:",i),n})},_headerDuplicatesTitle(e){if(e.tagName!="H1"&&e.tagName!="H2")return!1;var r=this._getInnerText(e,!1);return this.log("Evaluating similarity of header:",r,this._articleTitle),this._textSimilarity(this._articleTitle,r)>.75},_flagIsActive(e){return(this._flags&e)>0},_removeFlag(e){this._flags=this._flags&~e},_isProbablyVisible(e){return(!e.style||e.style.display!="none")&&(!e.style||e.style.visibility!="hidden")&&!e.hasAttribute("hidden")&&(!e.hasAttribute("aria-hidden")||e.getAttribute("aria-hidden")!="true"||e.className&&e.className.includes&&e.className.includes("fallback-image"))},parse(){if(this._maxElemsToParse>0){var e=this._doc.getElementsByTagName("*").length;if(e>this._maxElemsToParse)throw new Error("Aborting parsing document; "+e+" elements found")}this._unwrapNoscriptImages(this._doc);var r=this._disableJSONLD?{}:this._getJSONLD(this._doc);this._removeScripts(this._doc),this._prepDocument();var i=this._getArticleMetadata(r);this._metadata=i,this._articleTitle=i.title;var n=this._grabArticle();if(!n)return null;if(this.log("Grabbed: "+n.innerHTML),this._postProcessContent(n),!i.excerpt){var o=n.getElementsByTagName("p");o.length&&(i.excerpt=o[0].textContent.trim())}var s=n.textContent;return{title:this._articleTitle,byline:i.byline||this._articleByline,dir:this._articleDir,lang:this._articleLang,content:this._serializer(n),textContent:s,length:s.length,excerpt:i.excerpt,siteName:i.siteName||this._articleSiteName,publishedTime:i.publishedTime}}},t.exports=a})(Ye);var vt=Ye.exports,pt={exports:{}};(function(t){var a={unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i};function e(i){return(!i.style||i.style.display!="none")&&!i.hasAttribute("hidden")&&(!i.hasAttribute("aria-hidden")||i.getAttribute("aria-hidden")!="true"||i.className&&i.className.includes&&i.className.includes("fallback-image"))}function r(i,n={}){typeof n=="function"&&(n={visibilityChecker:n});var o={minScore:20,minContentLength:140,visibilityChecker:e};n=Object.assign(o,n);var s=i.querySelectorAll("p, pre, article"),l=i.querySelectorAll("div > br");if(l.length){var h=new Set(s);[].forEach.call(l,function(c){h.add(c.parentNode)}),s=Array.from(h)}var f=0;return[].some.call(s,function(c){if(!n.visibilityChecker(c))return!1;var u=c.className+" "+c.id;if(a.unlikelyCandidates.test(u)&&!a.okMaybeItsACandidate.test(u)||c.matches("li p"))return!1;var m=c.textContent.trim().length;return m<n.minContentLength?!1:(f+=Math.sqrt(m-n.minContentLength),f>n.minScore)})}t.exports=r})(pt);var _t=vt,Et={Readability:_t};function Nt(t){for(var a=1;a<arguments.length;a++){var e=arguments[a];for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])}return t}function ce(t,a){return Array(a+1).join(t)}function qe(t){return t.replace(/^\n*/,"")}function Ke(t){for(var a=t.length;a>0&&t[a-1]===`
`;)a--;return t.substring(0,a)}function ze(t){return Ke(qe(t))}var yt=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function be(t){return Te(t,yt)}var Je=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function Qe(t){return Te(t,Je)}function bt(t){return et(t,Je)}var Ze=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function Tt(t){return Te(t,Ze)}function At(t){return et(t,Ze)}function Te(t,a){return a.indexOf(t.nodeName)>=0}function et(t,a){return t.getElementsByTagName&&a.some(function(e){return t.getElementsByTagName(e).length})}var E={};E.paragraph={filter:"p",replacement:function(t){return`

`+t+`

`}};E.lineBreak={filter:"br",replacement:function(t,a,e){return e.br+`
`}};E.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(t,a,e){var r=Number(a.nodeName.charAt(1));if(e.headingStyle==="setext"&&r<3){var i=ce(r===1?"=":"-",t.length);return`

`+t+`
`+i+`

`}else return`

`+ce("#",r)+" "+t+`

`}};E.blockquote={filter:"blockquote",replacement:function(t){return t=ze(t).replace(/^/gm,"> "),`

`+t+`

`}};E.list={filter:["ul","ol"],replacement:function(t,a){var e=a.parentNode;return e.nodeName==="LI"&&e.lastElementChild===a?`
`+t:`

`+t+`

`}};E.listItem={filter:"li",replacement:function(t,a,e){var r=e.bulletListMarker+"   ",i=a.parentNode;if(i.nodeName==="OL"){var n=i.getAttribute("start"),o=Array.prototype.indexOf.call(i.children,a);r=(n?Number(n)+o:o+1)+".  "}var s=/\n$/.test(t);return t=ze(t)+(s?`
`:""),t=t.replace(/\n/gm,`
`+" ".repeat(r.length)),r+t+(a.nextSibling?`
`:"")}};E.indentedCodeBlock={filter:function(t,a){return a.codeBlockStyle==="indented"&&t.nodeName==="PRE"&&t.firstChild&&t.firstChild.nodeName==="CODE"},replacement:function(t,a,e){return`

    `+a.firstChild.textContent.replace(/\n/g,`
    `)+`

`}};E.fencedCodeBlock={filter:function(t,a){return a.codeBlockStyle==="fenced"&&t.nodeName==="PRE"&&t.firstChild&&t.firstChild.nodeName==="CODE"},replacement:function(t,a,e){for(var r=a.firstChild.getAttribute("class")||"",i=(r.match(/language-(\S+)/)||[null,""])[1],n=a.firstChild.textContent,o=e.fence.charAt(0),s=3,l=new RegExp("^"+o+"{3,}","gm"),h;h=l.exec(n);)h[0].length>=s&&(s=h[0].length+1);var f=ce(o,s);return`

`+f+i+`
`+n.replace(/\n$/,"")+`
`+f+`

`}};E.horizontalRule={filter:"hr",replacement:function(t,a,e){return`

`+e.hr+`

`}};E.inlineLink={filter:function(t,a){return a.linkStyle==="inlined"&&t.nodeName==="A"&&t.getAttribute("href")},replacement:function(t,a){var e=a.getAttribute("href");e&&(e=e.replace(/([()])/g,"\\$1"));var r=j(a.getAttribute("title"));return r&&(r=' "'+r.replace(/"/g,'\\"')+'"'),"["+t+"]("+e+r+")"}};E.referenceLink={filter:function(t,a){return a.linkStyle==="referenced"&&t.nodeName==="A"&&t.getAttribute("href")},replacement:function(t,a,e){var r=a.getAttribute("href"),i=j(a.getAttribute("title"));i&&(i=' "'+i+'"');var n,o;switch(e.linkReferenceStyle){case"collapsed":n="["+t+"][]",o="["+t+"]: "+r+i;break;case"shortcut":n="["+t+"]",o="["+t+"]: "+r+i;break;default:var s=this.references.length+1;n="["+t+"]["+s+"]",o="["+s+"]: "+r+i}return this.references.push(o),n},references:[],append:function(t){var a="";return this.references.length&&(a=`

`+this.references.join(`
`)+`

`,this.references=[]),a}};E.emphasis={filter:["em","i"],replacement:function(t,a,e){return t.trim()?e.emDelimiter+t+e.emDelimiter:""}};E.strong={filter:["strong","b"],replacement:function(t,a,e){return t.trim()?e.strongDelimiter+t+e.strongDelimiter:""}};E.code={filter:function(t){var a=t.previousSibling||t.nextSibling,e=t.parentNode.nodeName==="PRE"&&!a;return t.nodeName==="CODE"&&!e},replacement:function(t){if(!t)return"";t=t.replace(/\r?\n|\r/g," ");for(var a=/^`|^ .*?[^ ].* $|`$/.test(t)?" ":"",e="`",r=t.match(/`+/gm)||[];r.indexOf(e)!==-1;)e=e+"`";return e+a+t+a+e}};E.image={filter:"img",replacement:function(t,a){var e=j(a.getAttribute("alt")),r=a.getAttribute("src")||"",i=j(a.getAttribute("title")),n=i?' "'+i+'"':"";return r?"!["+e+"]("+r+n+")":""}};function j(t){return t?t.replace(/(\n+\s*)+/g,`
`):""}function tt(t){this.options=t,this._keep=[],this._remove=[],this.blankRule={replacement:t.blankReplacement},this.keepReplacement=t.keepReplacement,this.defaultRule={replacement:t.defaultReplacement},this.array=[];for(var a in t.rules)this.array.push(t.rules[a])}tt.prototype={add:function(t,a){this.array.unshift(a)},keep:function(t){this._keep.unshift({filter:t,replacement:this.keepReplacement})},remove:function(t){this._remove.unshift({filter:t,replacement:function(){return""}})},forNode:function(t){if(t.isBlank)return this.blankRule;var a;return(a=ne(this.array,t,this.options))||(a=ne(this._keep,t,this.options))||(a=ne(this._remove,t,this.options))?a:this.defaultRule},forEach:function(t){for(var a=0;a<this.array.length;a++)t(this.array[a],a)}};function ne(t,a,e){for(var r=0;r<t.length;r++){var i=t[r];if(St(i,a,e))return i}}function St(t,a,e){var r=t.filter;if(typeof r=="string"){if(r===a.nodeName.toLowerCase())return!0}else if(Array.isArray(r)){if(r.indexOf(a.nodeName.toLowerCase())>-1)return!0}else if(typeof r=="function"){if(r.call(t,a,e))return!0}else throw new TypeError("`filter` needs to be a string, array, or function")}function Lt(t){var a=t.element,e=t.isBlock,r=t.isVoid,i=t.isPre||function(c){return c.nodeName==="PRE"};if(!(!a.firstChild||i(a))){for(var n=null,o=!1,s=null,l=Me(s,a,i);l!==a;){if(l.nodeType===3||l.nodeType===4){var h=l.data.replace(/[ \r\n\t]+/g," ");if((!n||/ $/.test(n.data))&&!o&&h[0]===" "&&(h=h.substr(1)),!h){l=ae(l);continue}l.data=h,n=l}else if(l.nodeType===1)e(l)||l.nodeName==="BR"?(n&&(n.data=n.data.replace(/ $/,"")),n=null,o=!1):r(l)||i(l)?(n=null,o=!0):n&&(o=!1);else{l=ae(l);continue}var f=Me(s,l,i);s=l,l=f}n&&(n.data=n.data.replace(/ $/,""),n.data||ae(n))}}function ae(t){var a=t.nextSibling||t.parentNode;return t.parentNode.removeChild(t),a}function Me(t,a,e){return t&&t.parentNode===a||e(a)?a.nextSibling||a.parentNode:a.firstChild||a.nextSibling||a.parentNode}var Ae=typeof window<"u"?window:{};function wt(){var t=Ae.DOMParser,a=!1;try{new t().parseFromString("","text/html")&&(a=!0)}catch{}return a}function xt(){var t=function(){};return Rt()?t.prototype.parseFromString=function(a){var e=new window.ActiveXObject("htmlfile");return e.designMode="on",e.open(),e.write(a),e.close(),e}:t.prototype.parseFromString=function(a){var e=document.implementation.createHTMLDocument("");return e.open(),e.write(a),e.close(),e},t}function Rt(){var t=!1;try{document.implementation.createHTMLDocument("").open()}catch{Ae.ActiveXObject&&(t=!0)}return t}var It=wt()?Ae.DOMParser:xt();function Ct(t,a){var e;if(typeof t=="string"){var r=Dt().parseFromString('<x-turndown id="turndown-root">'+t+"</x-turndown>","text/html");e=r.getElementById("turndown-root")}else e=t.cloneNode(!0);return Lt({element:e,isBlock:be,isVoid:Qe,isPre:a.preformattedCode?kt:null}),e}var se;function Dt(){return se=se||new It,se}function kt(t){return t.nodeName==="PRE"||t.nodeName==="CODE"}function Bt(t,a){return t.isBlock=be(t),t.isCode=t.nodeName==="CODE"||t.parentNode.isCode,t.isBlank=Pt(t),t.flankingWhitespace=Ot(t,a),t}function Pt(t){return!Qe(t)&&!Tt(t)&&/^\s*$/i.test(t.textContent)&&!bt(t)&&!At(t)}function Ot(t,a){if(t.isBlock||a.preformattedCode&&t.isCode)return{leading:"",trailing:""};var e=Mt(t.textContent);return e.leadingAscii&&He("left",t,a)&&(e.leading=e.leadingNonAscii),e.trailingAscii&&He("right",t,a)&&(e.trailing=e.trailingNonAscii),{leading:e.leading,trailing:e.trailing}}function Mt(t){var a=t.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);return{leading:a[1],leadingAscii:a[2],leadingNonAscii:a[3],trailing:a[4],trailingNonAscii:a[5],trailingAscii:a[6]}}function He(t,a,e){var r,i,n;return t==="left"?(r=a.previousSibling,i=/ $/):(r=a.nextSibling,i=/^ /),r&&(r.nodeType===3?n=i.test(r.nodeValue):e.preformattedCode&&r.nodeName==="CODE"?n=!1:r.nodeType===1&&!be(r)&&(n=i.test(r.textContent))),n}var Ht=Array.prototype.reduce,Ut=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function Y(t){if(!(this instanceof Y))return new Y(t);var a={rules:E,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(e,r){return r.isBlock?`

`:""},keepReplacement:function(e,r){return r.isBlock?`

`+r.outerHTML+`

`:r.outerHTML},defaultReplacement:function(e,r){return r.isBlock?`

`+e+`

`:e}};this.options=Nt({},a,t),this.rules=new tt(this.options)}Y.prototype={turndown:function(t){if(!Ft(t))throw new TypeError(t+" is not a string, or an element/document/fragment node.");if(t==="")return"";var a=rt.call(this,new Ct(t,this.options));return $t.call(this,a)},use:function(t){if(Array.isArray(t))for(var a=0;a<t.length;a++)this.use(t[a]);else if(typeof t=="function")t(this);else throw new TypeError("plugin must be a Function or an Array of Functions");return this},addRule:function(t,a){return this.rules.add(t,a),this},keep:function(t){return this.rules.keep(t),this},remove:function(t){return this.rules.remove(t),this},escape:function(t){return Ut.reduce(function(a,e){return a.replace(e[0],e[1])},t)}};function rt(t){var a=this;return Ht.call(t.childNodes,function(e,r){r=new Bt(r,a.options);var i="";return r.nodeType===3?i=r.isCode?r.nodeValue:a.escape(r.nodeValue):r.nodeType===1&&(i=Gt.call(a,r)),it(e,i)},"")}function $t(t){var a=this;return this.rules.forEach(function(e){typeof e.append=="function"&&(t=it(t,e.append(a.options)))}),t.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function Gt(t){var a=this.rules.forNode(t),e=rt.call(this,t),r=t.flankingWhitespace;return(r.leading||r.trailing)&&(e=e.trim()),r.leading+a.replacement(e,t,this.options)+r.trailing}function it(t,a){var e=Ke(t),r=qe(a),i=Math.max(t.length-e.length,a.length-r.length),n=`

`.substring(0,i);return e+n+r}function Ft(t){return t!=null&&(typeof t=="string"||t.nodeType&&(t.nodeType===1||t.nodeType===9||t.nodeType===11))}var Ue=/highlight-(?:text|source)-([a-z0-9]+)/;function Wt(t){t.addRule("highlightedCodeBlock",{filter:function(a){var e=a.firstChild;return a.nodeName==="DIV"&&Ue.test(a.className)&&e&&e.nodeName==="PRE"},replacement:function(a,e,r){var i=e.className||"",n=(i.match(Ue)||[null,""])[1];return`

`+r.fence+n+`
`+e.firstChild.textContent+`
`+r.fence+`

`}})}function Vt(t){t.addRule("strikethrough",{filter:["del","s","strike"],replacement:function(a){return"~"+a+"~"}})}var Xt=Array.prototype.indexOf,jt=Array.prototype.every,k={};k.tableCell={filter:["th","td"],replacement:function(t,a){return nt(t,a)}};k.tableRow={filter:"tr",replacement:function(t,a){var e="",r={left:":--",right:"--:",center:":-:"};if(Se(a))for(var i=0;i<a.childNodes.length;i++){var n="---",o=(a.childNodes[i].getAttribute("align")||"").toLowerCase();o&&(n=r[o]||n),e+=nt(n,a.childNodes[i])}return`
`+t+(e?`
`+e:"")}};k.table={filter:function(t){return t.nodeName==="TABLE"&&Se(t.rows[0])},replacement:function(t){return t=t.replace(`

`,`
`),`

`+t+`

`}};k.tableSection={filter:["thead","tbody","tfoot"],replacement:function(t){return t}};function Se(t){var a=t.parentNode;return a.nodeName==="THEAD"||a.firstChild===t&&(a.nodeName==="TABLE"||Yt(a))&&jt.call(t.childNodes,function(e){return e.nodeName==="TH"})}function Yt(t){var a=t.previousSibling;return t.nodeName==="TBODY"&&(!a||a.nodeName==="THEAD"&&/^\s*$/i.test(a.textContent))}function nt(t,a){var e=Xt.call(a.parentNode.childNodes,a),r=" ";return e===0&&(r="| "),r+t+" |"}function qt(t){t.keep(function(e){return e.nodeName==="TABLE"&&!Se(e.rows[0])});for(var a in k)t.addRule(a,k[a])}function Kt(t){t.addRule("taskListItems",{filter:function(a){return a.type==="checkbox"&&a.parentNode.nodeName==="LI"},replacement:function(a,e){return(e.checked?"[x]":"[ ]")+" "}})}function zt(t){t.use([Wt,Vt,qt,Kt])}function Jt(t){const e=new DOMParser().parseFromString(t.html,"text/html"),r=e.createElement("base");r.href=t.url,e.head.prepend(r);const i=Qt();if(t.selectedHtml)return{markdown:i.turndown(t.selectedHtml),title:t.title};const n=new Et.Readability(e).parse();return!n||!n.content?{markdown:i.turndown(e.body),title:t.title}:{markdown:i.turndown(n.content),title:n.title||t.title,byline:n.byline||void 0,siteName:n.siteName||void 0,excerpt:n.excerpt||void 0}}function Qt(){const t=new Y({headingStyle:"atx",codeBlockStyle:"fenced",bulletListMarker:"-",emDelimiter:"_"});return t.use(zt),t.addRule("figure",{filter:"figure",replacement(a,e){var f;const r=e,i=r.querySelector("img"),n=r.querySelector("figcaption"),o=(i==null?void 0:i.getAttribute("alt"))||"",s=(i==null?void 0:i.getAttribute("src"))||"",l=((f=n==null?void 0:n.textContent)==null?void 0:f.trim())||"";let h=s?`![${o}](${s})`:"";return l&&(h+=`
_${l}_`),h?`

${h}

`:""}}),t.addRule("video",{filter:"video",replacement(a,e){var s;const r=e,i=r.src||((s=r.querySelector("source"))==null?void 0:s.getAttribute("src"))||"",n=r.getAttribute("poster");return i?`

[${n?`![Video](${n})`:"Video"}](${i})

`:""}}),t.addRule("iframe",{filter:"iframe",replacement(a,e){const r=e,i=r.src||"";return i?`

[${r.title||"Embedded content"}](${i})

`:""}}),t}ft(new gt);const V=document.getElementById("status"),Zt=document.getElementById("controls"),er=document.getElementById("channel-name"),tr=document.getElementById("message-count"),he=document.getElementById("copy-btn"),ue=document.getElementById("download-btn"),$e=document.getElementById("result"),Le=document.getElementById("result-message"),q=document.getElementById("error"),fe=document.getElementById("progress"),ge=document.getElementById("progress-fill"),de=document.getElementById("progress-text"),rr=document.getElementById("last-n-options"),ir=document.getElementById("date-range-options"),me=document.getElementById("date-from"),ve=document.getElementById("date-to"),nr=document.getElementById("include-threads"),ar=document.getElementById("include-reactions"),sr=document.getElementById("include-files"),lr=document.getElementById("include-frontmatter"),le=document.getElementById("frontmatter-settings");le==null||le.addEventListener("click",t=>{t.preventDefault(),chrome.runtime.openOptionsPage()});const or=document.getElementById("clip-controls"),Ge=document.getElementById("clip-page-title"),cr=document.getElementById("clip-include-frontmatter"),pe=document.getElementById("clip-copy-btn"),_e=document.getElementById("clip-download-btn"),Fe=document.getElementById("clip-result"),we=document.getElementById("clip-result-message"),We=document.getElementById("clip-progress"),Ve=document.getElementById("clip-progress-fill"),Xe=document.getElementById("clip-progress-text"),oe=document.getElementById("clip-frontmatter-settings");oe==null||oe.addEventListener("click",t=>{t.preventDefault(),chrome.runtime.openOptionsPage()});let Ee=null,Ne=null,at=null,ye=null,X="",U="";const je=document.querySelector(".version");je&&(je.textContent="v0.1.0");const hr=document.querySelectorAll('input[name="scope"]');hr.forEach(t=>{t.addEventListener("change",()=>{const a=t.value;rr.classList.toggle("hidden",a!=="last_n"),ir.classList.toggle("hidden",a!=="date_range")})});chrome.runtime.onMessage.addListener(t=>{if(t.type!=="PROGRESS")return;fe.classList.remove("hidden");const e={fetching:"Fetching messages",resolving_users:"Resolving users",fetching_threads:"Fetching threads",converting:"Converting to markdown"}[t.phase]||t.phase;if(t.total){const r=Math.round(t.current/t.total*100);ge.style.width=`${r}%`,de.textContent=`${e}: ${t.current}/${t.total}`}else ge.style.width="",de.textContent=t.current>0?`${e} (page ${t.current})...`:`${e}...`});function ur(){const t=document.querySelector('input[name="scope"]:checked').value;if(t==="date_range"){const a=me.value?new Date(me.value).getTime()/1e3:0,e=ve.value?new Date(ve.value+"T23:59:59").getTime()/1e3:Date.now()/1e3;return{mode:"date_range",oldest:a,latest:e}}return t==="all"?{mode:"all"}:{mode:"last_n",count:parseInt(tr.value,10)}}async function st(){if(!Ee)return null;$e.classList.add("hidden"),q.classList.add("hidden"),fe.classList.remove("hidden"),ge.style.width="0%",de.textContent="Starting...",he.disabled=!0,ue.disabled=!0;try{const t=await chrome.runtime.sendMessage({type:"FETCH_MESSAGES",channelId:Ee,scope:ur(),includeThreads:nr.checked,includeReactions:ar.checked,includeFiles:sr.checked,includeFrontmatter:lr.checked});return!t.success||!t.markdown?($(t.error||"Export failed"),null):(at=t.markdown,Le.textContent=`Exported ${t.messageCount} messages`,$e.classList.remove("hidden"),t.markdown)}catch(t){return $(t instanceof Error?t.message:"Unknown error"),null}finally{fe.classList.add("hidden"),he.disabled=!1,ue.disabled=!1}}he.addEventListener("click",async()=>{const t=await st();t&&(await navigator.clipboard.writeText(t),Le.textContent+=" — copied to clipboard!")});ue.addEventListener("click",async()=>{const t=await st();if(!t)return;const a=Ne?`${Ne}-${new Date().toISOString().split("T")[0]}.md`:`slack-export-${new Date().toISOString().split("T")[0]}.md`,e=new Blob([t],{type:"text/markdown"}),r=URL.createObjectURL(e),i=document.createElement("a");i.href=r,i.download=a,i.click(),URL.revokeObjectURL(r),Le.textContent+=" — downloaded!"});async function lt(){if(!ye)return null;Fe.classList.add("hidden"),q.classList.add("hidden"),We.classList.remove("hidden"),Ve.style.width="50%",Xe.textContent="Extracting article...",pe.disabled=!0,_e.disabled=!0;try{const[t]=await chrome.scripting.executeScript({target:{tabId:ye},func:()=>{let r;const i=window.getSelection();if(i&&i.rangeCount>0&&!i.isCollapsed){const n=document.createElement("div");n.appendChild(i.getRangeAt(0).cloneContents()),r=n.innerHTML}return{html:document.documentElement.outerHTML,url:location.href,title:document.title,selectedHtml:r}}});if(!(t!=null&&t.result))return $("Could not read page content."),null;Ve.style.width="80%",Xe.textContent="Converting to markdown...";const a=Jt(t.result);let e=a.markdown;if(cr.checked){const r={title:a.title,sourceUrl:X,author:a.byline,siteName:a.siteName,excerpt:a.excerpt};let i;try{const n=await dt("web");n?i=mt(n,r):i=Oe({title:a.title,source:"web-clip",source_url:X,author:a.byline||"",captured:new Date().toISOString(),tags:["web-clip"]})}catch{i=Oe({title:a.title,source:"web-clip",source_url:X,captured:new Date().toISOString(),tags:["web-clip"]})}e=i+`

`+e}return at=e,U=a.title||U,we.textContent=t.result.selectedHtml?"Clipped selection":"Clipped article",Fe.classList.remove("hidden"),e}catch(t){return $(t instanceof Error?t.message:"Clip failed"),null}finally{We.classList.add("hidden"),pe.disabled=!1,_e.disabled=!1}}pe.addEventListener("click",async()=>{const t=await lt();t&&(await navigator.clipboard.writeText(t),we.textContent+=" — copied to clipboard!")});_e.addEventListener("click",async()=>{const t=await lt();if(!t)return;const e=`${U.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"").slice(0,60)||"clip"}-${new Date().toISOString().split("T")[0]}.md`,r=new Blob([t],{type:"text/markdown"}),i=URL.createObjectURL(r),n=document.createElement("a");n.href=i,n.download=e,n.click(),URL.revokeObjectURL(i),we.textContent+=" — downloaded!"});function $(t){q.textContent=t,q.classList.remove("hidden")}async function fr(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0}),a=(t==null?void 0:t.url)||"",e=ut(a),r={type:"GET_STATUS",...e&&{channelId:e.channelId,workspaceId:e.workspaceId}};if(!e){ye=(t==null?void 0:t.id)??null,X=a,U=(t==null?void 0:t.title)||a,Ge.textContent=U,Ge.title=a,V.classList.add("hidden"),or.classList.remove("hidden");return}const i=await chrome.runtime.sendMessage(r);if(!i.hasToken){V.textContent="No Slack session detected. Please open Slack and refresh the page.";return}if(!i.channelId){V.textContent="Please navigate to a Slack channel.";return}Ee=i.channelId,Ne=i.channelName||null,er.textContent=i.channelName?`#${i.channelName}`:i.channelId;const n=new Date,o=new Date(n.getTime()-7*24*60*60*1e3);ve.value=n.toISOString().split("T")[0],me.value=o.toISOString().split("T")[0],V.classList.add("hidden"),Zt.classList.remove("hidden")}catch{$("Failed to connect to extension. Try reloading the page.")}}fr();
