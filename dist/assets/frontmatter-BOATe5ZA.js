import{S as h}from"./constants-I65fpLFJ.js";const u={slack_default:{name:"Slack Default",enabled:!0,category:"slack",frontmatter:{title:"{{channel}}",source:"{{source_category}}",source_url:"{{source_url}}",workspace:"{{workspace}}",channel:"{{channel}}",channel_type:"{{channel_type}}",captured:'{{captured|date:"YYYY-MM-DDTHH:mm:ssZ"}}',date_range:"{{date_range}}",message_count:"{{message_count}}",tags:["slack"]}},slack_detailed:{name:"Slack Detailed",enabled:!1,category:"slack",frontmatter:{title:"{{channel}}",source:"{{source_category}}",source_url:"{{source_url}}",workspace:"{{workspace}}",channel:"{{channel}}",channel_type:"{{channel_type}}",topic:"{{topic}}",purpose:"{{purpose}}",captured:'{{captured|date:"YYYY-MM-DDTHH:mm:ssZ"}}',date_range:"{{date_range}}",message_count:"{{message_count}}",export_scope:"{{export_scope}}",tags:["slack","{{workspace|lowercase|slug}}"]}},web_default:{name:"Web Clip Default",enabled:!0,category:"web",frontmatter:{title:"{{title}}",source:"{{source_category}}",source_url:"{{source_url}}",author:"{{author}}",published:'{{published|date:"YYYY-MM-DD"}}',captured:'{{captured|date:"YYYY-MM-DDTHH:mm:ssZ"}}',tags:["web-clip"]}}},U=new Set(Object.keys(u));let p;function P(e){p=e}function Y(e){if(!e)return structuredClone(u);const t={...e};for(const[r,n]of Object.entries(u))r in t||(t[r]=structuredClone(n));return t}function E(e,t){for(const r of Object.values(e))if(r.category===t&&r.enabled)return r;return null}async function A(){const e=await p.get(h.TEMPLATES);return Y(e??null)}async function Q(e){await p.set(h.TEMPLATES,e)}async function Z(e){const t=await A();return E(t,e)}class J{async get(t){return(await chrome.storage.local.get(t))[t]}async set(t,r){await chrome.storage.local.set({[t]:r})}async remove(t){await chrome.storage.local.remove(t)}}class R{async get(t){return(await chrome.storage.sync.get(t))[t]}async set(t,r){await chrome.storage.sync.set({[t]:r})}async remove(t){await chrome.storage.sync.remove(t)}}const C=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],$=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function F(e,t){const r=e.getFullYear(),n=e.getMonth(),s=e.getDate(),a=e.getHours(),c=e.getMinutes(),l=e.getSeconds(),i=e.getTimezoneOffset(),T=i<=0?"+":"-",b=String(Math.floor(Math.abs(i)/60)).padStart(2,"0"),k=String(Math.abs(i)%60).padStart(2,"0"),M=`${T}${b}:${k}`;let o=t;return o=o.replace(/YYYY/g,String(r)),o=o.replace(/MMM/g,$[n]),o=o.replace(/MM/g,String(n+1).padStart(2,"0")),o=o.replace(/DD/g,String(s).padStart(2,"0")),o=o.replace(/HH/g,String(a).padStart(2,"0")),o=o.replace(/mm/g,String(c).padStart(2,"0")),o=o.replace(/ss/g,String(l).padStart(2,"0")),o=o.replace(/ddd/g,C[e.getDay()]),o=o.replace(/Z/g,M),o}function O(e){const t=v(e.trim()),r=t[0].trim(),n=[];for(let s=1;s<t.length;s++){const a=t[s].trim();if(!a)continue;const c=H(a);if(c===-1)n.push({name:a});else{const l=a.slice(0,c).trim();let i=a.slice(c+1).trim();(i.startsWith('"')&&i.endsWith('"')||i.startsWith("'")&&i.endsWith("'"))&&(i=i.slice(1,-1)),n.push({name:l,arg:i})}}return{variable:r,filters:n}}function v(e){const t=[];let r="",n=null;for(const s of e)n?(r+=s,s===n&&(n=null)):s==='"'||s==="'"?(r+=s,n=s):s==="|"?(t.push(r),r=""):r+=s;return t.push(r),t}function H(e){let t=null;for(let r=0;r<e.length;r++){const n=e[r];if(t)n===t&&(t=null);else if(n==='"'||n==="'")t=n;else if(n===":")return r}return-1}function N(e){if(e instanceof Date)return e;if(typeof e=="string"){const t=new Date(e);if(!isNaN(t.getTime()))return t}if(typeof e=="number"){const t=new Date(e);if(!isNaN(t.getTime()))return t}return null}function W(e,t){switch(t.name){case"date":{const r=N(e);return r?F(r,t.arg??"YYYY-MM-DD"):e}case"lowercase":return String(e??"").toLowerCase();case"uppercase":return String(e??"").toUpperCase();case"default":return e==null||e===""?t.arg??"":e;case"join":{if(Array.isArray(e)){const r=t.arg??", ";return e.join(r)}return e}case"slug":return String(e??"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");case"trim":return String(e??"").trim();case"truncate":{const r=String(e??""),n=parseInt(t.arg??"100",10);return r.length<=n?r:r.slice(0,n)+"â€¦"}default:return e}}function g(e,t){const r=/^\{\{(.+?)\}\}$/.exec(e);return r?m(r[1],t):e.replace(/\{\{(.+?)\}\}/g,(n,s)=>{const a=m(s,t);return a==null?"":String(a)})}function m(e,t){const r=O(e);let n=t[r.variable];for(const s of r.filters)n=W(n,s);return n}function _(e,t){const r={};for(const[n,s]of Object.entries(e))if(typeof s=="string"){const a=g(s,t);if(a==null||a==="")continue;r[n]=a}else if(Array.isArray(s)){const a=s.map(c=>typeof c=="string"?g(c,t):c).filter(c=>c!=null&&c!=="");a.length>0&&(r[n]=a)}else s!=null&&(r[n]=s);return r}function S(e){return e.is_im?"slack-dm":e.is_mpim?"slack-group-dm":e.is_group&&!e.is_mpim||e.is_private?"slack-private-channel":"slack-channel"}function y(e){return e.is_im?"dm":e.is_mpim?"group_dm":e.is_group&&!e.is_mpim||e.is_private?"private_channel":"public_channel"}function w(e,t){return`https://${e}.slack.com/archives/${t}`}function D(e){if(e.length===0)return"";const t=parseFloat(e[0].ts)*1e3,r=parseFloat(e[e.length-1].ts)*1e3,n=new Date(t).toISOString().split("T")[0],s=new Date(r).toISOString().split("T")[0];return n===s?n:`${n} to ${s}`}function d(e){if(e==null)return"";if(typeof e=="number"||typeof e=="boolean")return String(e);const t=String(e);return t===""?'""':/[:#\[\]{}&*!|>'"%@`,?]/.test(t)||/^\s|\s$/.test(t)||/^(true|false|null|yes|no|on|off)$/i.test(t)||/^-?\d/.test(t)?`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:t}function f(e){const t=["---"];for(const[r,n]of Object.entries(e))if(!(n==null||n===""))if(Array.isArray(n)){if(n.length===0)continue;t.push(`${r}:`);for(const s of n)t.push(`  - ${d(s)}`)}else t.push(`${r}: ${d(n)}`);return t.push("---"),t.join(`
`)}function L(e){return e.mode==="last_n"?`last_${e.count}`:e.mode==="date_range"?"date_range":"all"}function j(e){return{channel:e.channel.name,channel_id:e.channel.id,channel_type:y(e.channel),topic:e.channel.topic??"",purpose:e.channel.purpose??"",workspace:e.workspaceName,workspace_domain:e.workspaceDomain,source_category:S(e.channel),source_url:w(e.workspaceDomain,e.channel.id),captured:new Date,date_range:D(e.messages),message_count:e.messageCount,export_scope:L(e.scope)}}function B(e,t){const r=j(t),n=_(e.frontmatter,r);return f(n)}function z(e){return{title:e.title,source_category:"web-clip",source_url:e.sourceUrl,author:e.author??"",site_name:e.siteName??"",excerpt:e.excerpt??"",captured:new Date}}function K(e,t){const r=z(t),n=_(e.frontmatter,r);return f(n)}function q(e){const t=S(e.channel),r=y(e.channel),n=w(e.workspaceDomain,e.channel.id),s=D(e.messages),a=new Date().toISOString(),c={title:`#${e.channel.name}`,source:t,source_url:n,workspace:e.workspaceName,channel:e.channel.name,channel_type:r,captured:a,date_range:s,message_count:e.messageCount,tags:["slack"]};return f(c)}export{U as B,u as D,R as E,q as a,B as b,J as c,Q as d,K as e,Z as g,P as i,A as l,_ as r,f as s};
