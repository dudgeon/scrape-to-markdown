import{S as d}from"./constants-I65fpLFJ.js";const u={slack_default:{name:"Slack Default",enabled:!0,category:"slack",frontmatter:{title:"{{channel}}",source:"{{source_category}}",source_url:"{{source_url}}",workspace:"{{workspace}}",channel:"{{channel}}",channel_type:"{{channel_type}}",captured:'{{captured|date:"YYYY-MM-DDTHH:mm:ssZ"}}',date_range:"{{date_range}}",message_count:"{{message_count}}",tags:["slack"]}},slack_detailed:{name:"Slack Detailed",enabled:!1,category:"slack",frontmatter:{title:"{{channel}}",source:"{{source_category}}",source_url:"{{source_url}}",workspace:"{{workspace}}",channel:"{{channel}}",channel_type:"{{channel_type}}",topic:"{{topic}}",purpose:"{{purpose}}",captured:'{{captured|date:"YYYY-MM-DDTHH:mm:ssZ"}}',date_range:"{{date_range}}",message_count:"{{message_count}}",export_scope:"{{export_scope}}",tags:["slack","{{workspace|lowercase|slug}}"]}},web_default:{name:"Web Clip Default",enabled:!0,category:"web",frontmatter:{title:"{{title}}",source:"{{source_category}}",source_url:"{{source_url}}",author:"{{author}}",published:'{{published|date:"YYYY-MM-DD"}}',captured:'{{captured|date:"YYYY-MM-DDTHH:mm:ssZ"}}',tags:["web-clip"]}}},W=new Set(Object.keys(u));let p;function U(e){p=e}function b(e){if(!e)return structuredClone(u);const t={...e};for(const[r,n]of Object.entries(u))r in t||(t[r]=structuredClone(n));return t}function Y(e,t){for(const r of Object.values(e))if(r.category===t&&r.enabled)return r;return null}async function E(){const e=await p.get(d.TEMPLATES);return b(e??null)}async function P(e){await p.set(d.TEMPLATES,e)}async function Q(e){const t=await E();return Y(t,e)}class Z{async get(t){return(await chrome.storage.local.get(t))[t]}async set(t,r){await chrome.storage.local.set({[t]:r})}async remove(t){await chrome.storage.local.remove(t)}}class J{async get(t){return(await chrome.storage.sync.get(t))[t]}async set(t,r){await chrome.storage.sync.set({[t]:r})}async remove(t){await chrome.storage.sync.remove(t)}}const A=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],$=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function C(e,t){const r=e.getFullYear(),n=e.getMonth(),s=e.getDate(),a=e.getHours(),c=e.getMinutes(),l=e.getSeconds(),i=e.getTimezoneOffset(),w=i<=0?"+":"-",T=String(Math.floor(Math.abs(i)/60)).padStart(2,"0"),k=String(Math.abs(i)%60).padStart(2,"0"),M=`${w}${T}:${k}`;let o=t;return o=o.replace(/YYYY/g,String(r)),o=o.replace(/MMM/g,$[n]),o=o.replace(/MM/g,String(n+1).padStart(2,"0")),o=o.replace(/DD/g,String(s).padStart(2,"0")),o=o.replace(/HH/g,String(a).padStart(2,"0")),o=o.replace(/mm/g,String(c).padStart(2,"0")),o=o.replace(/ss/g,String(l).padStart(2,"0")),o=o.replace(/ddd/g,A[e.getDay()]),o=o.replace(/Z/g,M),o}function O(e){const t=v(e.trim()),r=t[0].trim(),n=[];for(let s=1;s<t.length;s++){const a=t[s].trim();if(!a)continue;const c=F(a);if(c===-1)n.push({name:a});else{const l=a.slice(0,c).trim();let i=a.slice(c+1).trim();(i.startsWith('"')&&i.endsWith('"')||i.startsWith("'")&&i.endsWith("'"))&&(i=i.slice(1,-1)),n.push({name:l,arg:i})}}return{variable:r,filters:n}}function v(e){const t=[];let r="",n=null;for(const s of e)n?(r+=s,s===n&&(n=null)):s==='"'||s==="'"?(r+=s,n=s):s==="|"?(t.push(r),r=""):r+=s;return t.push(r),t}function F(e){let t=null;for(let r=0;r<e.length;r++){const n=e[r];if(t)n===t&&(t=null);else if(n==='"'||n==="'")t=n;else if(n===":")return r}return-1}function H(e){if(e instanceof Date)return e;if(typeof e=="string"){const t=new Date(e);if(!isNaN(t.getTime()))return t}if(typeof e=="number"){const t=new Date(e);if(!isNaN(t.getTime()))return t}return null}function L(e,t){switch(t.name){case"date":{const r=H(e);return r?C(r,t.arg??"YYYY-MM-DD"):e}case"lowercase":return String(e??"").toLowerCase();case"uppercase":return String(e??"").toUpperCase();case"default":return e==null||e===""?t.arg??"":e;case"join":{if(Array.isArray(e)){const r=t.arg??", ";return e.join(r)}return e}case"slug":return String(e??"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");case"trim":return String(e??"").trim();case"truncate":{const r=String(e??""),n=parseInt(t.arg??"100",10);return r.length<=n?r:r.slice(0,n)+"â€¦"}default:return e}}function f(e,t){const r=/^\{\{(.+?)\}\}$/.exec(e);return r?g(r[1],t):e.replace(/\{\{(.+?)\}\}/g,(n,s)=>{const a=g(s,t);return a==null?"":String(a)})}function g(e,t){const r=O(e);let n=t[r.variable];for(const s of r.filters)n=L(n,s);return n}function N(e,t){const r={};for(const[n,s]of Object.entries(e))if(typeof s=="string"){const a=f(s,t);if(a==null||a==="")continue;r[n]=a}else if(Array.isArray(s)){const a=s.map(c=>typeof c=="string"?f(c,t):c).filter(c=>c!=null&&c!=="");a.length>0&&(r[n]=a)}else s!=null&&(r[n]=s);return r}function h(e){return e.is_im?"slack-dm":e.is_mpim?"slack-group-dm":e.is_group&&!e.is_mpim||e.is_private?"slack-private-channel":"slack-channel"}function _(e){return e.is_im?"dm":e.is_mpim?"group_dm":e.is_group&&!e.is_mpim||e.is_private?"private_channel":"public_channel"}function S(e,t){return`https://${e}.slack.com/archives/${t}`}function y(e){if(e.length===0)return"";const t=parseFloat(e[0].ts)*1e3,r=parseFloat(e[e.length-1].ts)*1e3,n=new Date(t).toISOString().split("T")[0],s=new Date(r).toISOString().split("T")[0];return n===s?n:`${n} to ${s}`}function m(e){if(e==null)return"";if(typeof e=="number"||typeof e=="boolean")return String(e);const t=String(e);return t===""?'""':/[:#\[\]{}&*!|>'"%@`,?]/.test(t)||/^\s|\s$/.test(t)||/^(true|false|null|yes|no|on|off)$/i.test(t)||/^-?\d/.test(t)?`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:t}function D(e){const t=["---"];for(const[r,n]of Object.entries(e))if(!(n==null||n===""))if(Array.isArray(n)){if(n.length===0)continue;t.push(`${r}:`);for(const s of n)t.push(`  - ${m(s)}`)}else t.push(`${r}: ${m(n)}`);return t.push("---"),t.join(`
`)}function j(e){return e.mode==="last_n"?`last_${e.count}`:e.mode==="date_range"?"date_range":"all"}function z(e){return{channel:e.channel.name,channel_id:e.channel.id,channel_type:_(e.channel),topic:e.channel.topic??"",purpose:e.channel.purpose??"",workspace:e.workspaceName,workspace_domain:e.workspaceDomain,source_category:h(e.channel),source_url:S(e.workspaceDomain,e.channel.id),captured:new Date,date_range:y(e.messages),message_count:e.messageCount,export_scope:j(e.scope)}}function R(e,t){const r=z(t),n=N(e.frontmatter,r);return D(n)}function B(e){const t=h(e.channel),r=_(e.channel),n=S(e.workspaceDomain,e.channel.id),s=y(e.messages),a=new Date().toISOString(),c={title:`#${e.channel.name}`,source:t,source_url:n,workspace:e.workspaceName,channel:e.channel.name,channel_type:r,captured:a,date_range:s,message_count:e.messageCount,tags:["slack"]};return D(c)}export{W as B,u as D,J as E,B as a,R as b,Z as c,P as d,Q as g,U as i,E as l,N as r,D as s};
