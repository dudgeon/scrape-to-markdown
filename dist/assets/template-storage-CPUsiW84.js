import{S as l}from"./constants-I65fpLFJ.js";const M=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Y(e,t){const n=e.getFullYear(),r=e.getMonth(),s=e.getDate(),a=e.getHours(),c=e.getMinutes(),u=e.getSeconds(),i=e.getTimezoneOffset(),D=i<=0?"+":"-",T=String(Math.floor(Math.abs(i)/60)).padStart(2,"0"),k=String(Math.abs(i)%60).padStart(2,"0"),w=`${D}${T}:${k}`;let o=t;return o=o.replace(/YYYY/g,String(n)),o=o.replace(/MMM/g,b[r]),o=o.replace(/MM/g,String(r+1).padStart(2,"0")),o=o.replace(/DD/g,String(s).padStart(2,"0")),o=o.replace(/HH/g,String(a).padStart(2,"0")),o=o.replace(/mm/g,String(c).padStart(2,"0")),o=o.replace(/ss/g,String(u).padStart(2,"0")),o=o.replace(/ddd/g,M[e.getDay()]),o=o.replace(/Z/g,w),o}function A(e){const t=E(e.trim()),n=t[0].trim(),r=[];for(let s=1;s<t.length;s++){const a=t[s].trim();if(!a)continue;const c=$(a);if(c===-1)r.push({name:a});else{const u=a.slice(0,c).trim();let i=a.slice(c+1).trim();(i.startsWith('"')&&i.endsWith('"')||i.startsWith("'")&&i.endsWith("'"))&&(i=i.slice(1,-1)),r.push({name:u,arg:i})}}return{variable:n,filters:r}}function E(e){const t=[];let n="",r=null;for(const s of e)r?(n+=s,s===r&&(r=null)):s==='"'||s==="'"?(n+=s,r=s):s==="|"?(t.push(n),n=""):n+=s;return t.push(n),t}function $(e){let t=null;for(let n=0;n<e.length;n++){const r=e[n];if(t)r===t&&(t=null);else if(r==='"'||r==="'")t=r;else if(r===":")return n}return-1}function C(e){if(e instanceof Date)return e;if(typeof e=="string"){const t=new Date(e);if(!isNaN(t.getTime()))return t}if(typeof e=="number"){const t=new Date(e);if(!isNaN(t.getTime()))return t}return null}function O(e,t){switch(t.name){case"date":{const n=C(e);return n?Y(n,t.arg??"YYYY-MM-DD"):e}case"lowercase":return String(e??"").toLowerCase();case"uppercase":return String(e??"").toUpperCase();case"default":return e==null||e===""?t.arg??"":e;case"join":{if(Array.isArray(e)){const n=t.arg??", ";return e.join(n)}return e}case"slug":return String(e??"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");case"trim":return String(e??"").trim();case"truncate":{const n=String(e??""),r=parseInt(t.arg??"100",10);return n.length<=r?n:n.slice(0,r)+"â€¦"}default:return e}}function f(e,t){const n=/^\{\{(.+?)\}\}$/.exec(e);return n?g(n[1],t):e.replace(/\{\{(.+?)\}\}/g,(r,s)=>{const a=g(s,t);return a==null?"":String(a)})}function g(e,t){const n=A(e);let r=t[n.variable];for(const s of n.filters)r=O(r,s);return r}function F(e,t){const n={};for(const[r,s]of Object.entries(e))if(typeof s=="string"){const a=f(s,t);if(a==null||a==="")continue;n[r]=a}else if(Array.isArray(s)){const a=s.map(c=>typeof c=="string"?f(c,t):c).filter(c=>c!=null&&c!=="");a.length>0&&(n[r]=a)}else s!=null&&(n[r]=s);return n}function d(e){return e.is_im?"slack-dm":e.is_mpim?"slack-group-dm":e.is_group&&!e.is_mpim||e.is_private?"slack-private-channel":"slack-channel"}function h(e){return e.is_im?"dm":e.is_mpim?"group_dm":e.is_group&&!e.is_mpim||e.is_private?"private_channel":"public_channel"}function _(e,t){return`https://${e}.slack.com/archives/${t}`}function S(e){if(e.length===0)return"";const t=parseFloat(e[0].ts)*1e3,n=parseFloat(e[e.length-1].ts)*1e3,r=new Date(t).toISOString().split("T")[0],s=new Date(n).toISOString().split("T")[0];return r===s?r:`${r} to ${s}`}function m(e){if(e==null)return"";if(typeof e=="number"||typeof e=="boolean")return String(e);const t=String(e);return t===""?'""':/[:#\[\]{}&*!|>'"%@`,?]/.test(t)||/^\s|\s$/.test(t)||/^(true|false|null|yes|no|on|off)$/i.test(t)||/^-?\d/.test(t)?`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:t}function y(e){const t=["---"];for(const[n,r]of Object.entries(e))if(!(r==null||r===""))if(Array.isArray(r)){if(r.length===0)continue;t.push(`${n}:`);for(const s of r)t.push(`  - ${m(s)}`)}else t.push(`${n}: ${m(r)}`);return t.push("---"),t.join(`
`)}function H(e){return e.mode==="last_n"?`last_${e.count}`:e.mode==="date_range"?"date_range":"all"}function L(e){return{channel:e.channel.name,channel_id:e.channel.id,channel_type:h(e.channel),topic:e.channel.topic??"",purpose:e.channel.purpose??"",workspace:e.workspaceName,workspace_domain:e.workspaceDomain,source_category:d(e.channel),source_url:_(e.workspaceDomain,e.channel.id),captured:new Date,date_range:S(e.messages),message_count:e.messageCount,export_scope:H(e.scope)}}function W(e,t){const n=L(t),r=F(e.frontmatter,n);return y(r)}function v(e){const t=d(e.channel),n=h(e.channel),r=_(e.workspaceDomain,e.channel.id),s=S(e.messages),a=new Date().toISOString(),c={title:`#${e.channel.name}`,source:t,source_url:r,workspace:e.workspaceName,channel:e.channel.name,channel_type:n,captured:a,date_range:s,message_count:e.messageCount,tags:["slack"]};return y(c)}const p={slack_default:{name:"Slack Default",enabled:!0,category:"slack",frontmatter:{title:"{{channel}}",source:"{{source_category}}",source_url:"{{source_url}}",workspace:"{{workspace}}",channel:"{{channel}}",channel_type:"{{channel_type}}",captured:'{{captured|date:"YYYY-MM-DDTHH:mm:ssZ"}}',date_range:"{{date_range}}",message_count:"{{message_count}}",tags:["slack"]}},slack_detailed:{name:"Slack Detailed",enabled:!1,category:"slack",frontmatter:{title:"{{channel}}",source:"{{source_category}}",source_url:"{{source_url}}",workspace:"{{workspace}}",channel:"{{channel}}",channel_type:"{{channel_type}}",topic:"{{topic}}",purpose:"{{purpose}}",captured:'{{captured|date:"YYYY-MM-DDTHH:mm:ssZ"}}',date_range:"{{date_range}}",message_count:"{{message_count}}",export_scope:"{{export_scope}}",tags:["slack","{{workspace|lowercase|slug}}"]}},web_default:{name:"Web Clip Default",enabled:!0,category:"web",frontmatter:{title:"{{title}}",source:"{{source_category}}",source_url:"{{source_url}}",author:"{{author}}",published:'{{published|date:"YYYY-MM-DD"}}',captured:'{{captured|date:"YYYY-MM-DDTHH:mm:ssZ"}}',tags:["web-clip"]}}},P=new Set(Object.keys(p));function N(e){if(!e)return structuredClone(p);const t={...e};for(const[n,r]of Object.entries(p))n in t||(t[n]=structuredClone(r));return t}function j(e,t){for(const n of Object.values(e))if(n.category===t&&n.enabled)return n;return null}async function z(){const t=(await chrome.storage.sync.get(l.TEMPLATES))[l.TEMPLATES];return N(t??null)}async function U(e){await chrome.storage.sync.set({[l.TEMPLATES]:e})}async function Q(e){const t=await z();return j(t,e)}export{P as B,p as D,v as a,W as b,U as c,Q as g,z as l,F as r,y as s};
